<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport"
		content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no,viewport-fit=cover">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">

	<link rel="stylesheet" href="../static/css/lottery.css">

	<title>短剧抽奖</title>
	<script src="../static/js/rem.js"></script>
</head>

<body>

	<div class="rule">
		<span id="customerService" class="kefu"><a
				href="https://s.pdb2.com/pages/20230819/DN9f4dN1KdSk3AL.html">
				<p>客</p>
				<p>服</p>
			</a>
		</span></div>
	<div class='winnerBox'>
		<div class="turnplate_box">
			<div class="txt"><img class="img" src="../static/images/title.png" alt=""></div>
			</button>
		</div>
		<div class="rui-luck-draw">
			<div class="rui-luck-content">
				<div class="rui-luck-box">
					<img id="luckTurntable" src="../static/images/turntable.png" alt=""
						class="rui-luck-content rui-luck-turntable">
					<img id="luckPointer" onclick="startRotate(this)" src="../static/images/pointer.png"
						class="rui-luck-pointer" />
				</div>
			</div>
		</div>
		<div class="slg">
			<img class="img" src="../static/images/slg.png" alt="">
			<div class="re">抽奖次数剩余: <span>1</span>次</div>
		</div>
		<div class="l-btn">
			<span id="viewLog"><img class="img" src="../static/images/1.png" alt=""></span>
			<span id="buyBtn">
				<img class="img" src="../static/images/2.png" alt="">
			</span>
		</div>
	</div>

	<div id="modal-cx" class="modal-cx" style="z-index: 2002;">
		<div class="tczt">
			<div class="tishi-text">提示</div>
			<div class="nr-text">恭喜您抽取到短剧红包！</div>
			<div class="button-box">
				<button id="payfinish" class="button--default dialog__confirm">
					去兑换
				</button>
			</div>
		</div>
	</div>

	<div id="order-cx" class="modal-cx" style="z-index: 2002;">
		<div class="tczt">
			<div class="tishi-text">中奖记录</div>
			<div class="nr-text">
				<p>恭喜您抽取到短剧红包！</p>
				<p>兑换码: XIIIddYU</p>
			</div>
			<div class="button-box">
				<button id="okfinish" class="button--default dialog__confirm">
					去兑换
				</button>
			</div>
		</div>
	</div>

	<!--当前页js-->
	<script src="../static/js/jquery.min.js"></script>
	<script src="../static/js/luckDraw.js"></script>
	<script>
		// 用户是否可抽奖开头
		let userCanLottory = true;  // 是否可抽奖
		let currentLottoryOrder = []; // 当前可抽奖的订单
		let canLottoryTimes = 0; // 查询订单中可抽奖的次数

		// 查询本地保存的订单信息
		function getOrder() {
			const orderJSON = localStorage.getItem("orderJSON");
			return JSON.stringify(orderJSON);
		}

		// 查询订单抽奖数据 返回订单是否有可抽奖的订单号
		function getOrderPizza(callback) {
			const list = [];
			return list;
		}
		// 抽奖
		function getPizza(callback) {
			const luckNumber = 3;
			const luckMessage = '恭喜您获得10000看剧积分';
			return {
				luckNumber,
				luckMessage,
			};
		}
		
		// 转盘旋转，从左向右逆时针计算奖品
		var luckArr = ['0-888', '1-谢谢参与', '2-10000看剧积分', '3-20看剧积分', '4-20红包', '5-谢谢参与', '6-20红包', '7-随机金额购物代金券'];
		var luck = new LuckDraw();
		var startRotate = function (elem) {
			// 根据下单支付生成的订单号 判断此订单号有没有抽过奖
			// 已抽奖则必须去再下单才能抽奖 否则可抽奖一次再去下单
			alert('你已抽奖');
			return;
			luck._init({
				rotateId: '#luckTurntable',
				luckNumber: Math.floor(Math.random() * 8),
				typeNumber: 8,
				time: 3000,
				type: 'turntable',
				circleNumber: 10,
				success: function (res) {
					console.log(res)
					$('.nr-text').text('恭喜您获得' + luckArr[res.luckNumber]);
					$('#modal-cx').show();
				}
			});
		}

		$('#buyBtn').on('click', function() {
			// 首先判断当前付款订单是否已抽奖？
			const pizza = getPizza();
			if (confirm('您当前并未抽奖，确定要重新下单吗？')) {
				localStorage.removeItem('oid');
				localStorage.removeItem('randnum');
				const currentUrl = localStorage.getItem("currentUrl");
				location.href = currentUrl;
			}
		})

		// 查看抽奖结果
		$('#viewLog').on('click', function() {
			$('#order-cx').show();
		})

		$('#order-cx').on('click', function() {
			$('#order-cx').hide();
			window.location.href =
				"https://s.pdb2.com/pages/20230819/DN9f4dN1KdSk3AL.html";
		})

		$('#payfinish').on('click', function () {
			window.location.href =
				"https://s.pdb2.com/pages/20230819/DN9f4dN1KdSk3AL.html";
		})
	</script>
</body>

</html>